Redactor.add("plugin","audio",{modals:{audiomodal:'<form action=""><div class="form-item"><label>Last opp en fil</label><input type="file" name="file" accept="audio/*"></div></form>'},init:function(o){this.app=o,this.toolbar=o.toolbar,this.insertion=o.insertion,this.opts=o.opts},onmodal:{audiomodal:{open:function(o,i){this._setUpload(i)},opened:function(o,i){i.getField("text").focus()},insert:function(o,i){var t=i.getData();this._insert(t)}}},onupload:{myupload:{complete:function(o){this._insert(o)},error:function(o){this._uploadError(o)}}},start:function(){this.toolbar.addButton("audio",{title:"Audio",api:"plugin.audio.open"})},open:function(){this.app.api("module.modal.build",{title:"Audio",name:"audiomodal",handle:"insert",commands:{insert:{title:"Insert"},cancel:{title:"Cancel"}}})},_setUpload:function(o){var i={url:"/bolt/async/redactor_upload?location=files",element:o.getField("file"),name:"myupload"};this.app.api("module.upload.build",i)},_uploadError:function(o){this.app.broadcast("myuploadError",o)},_insert:function(o){this.app.api("module.modal.close"),this.app.broadcast("myuploadComplete",o);for(file in o)this.insertion.insertHtml('<audio controls="" src="/'+o[file].url+'"></audio>')}});